import "http://vitruv.tools/methodologisttemplate/families" as families
import "http://vitruv.tools/methodologisttemplate/persons" as persons

reactions: familiesToPersons
in reaction to changes in families
execute actions in persons

reaction DeletedFamily {
	after element families::Family deleted
	call deletePerson(affectedEObject.father)
	call deletePerson(affectedEObject.mother)
	call affectedEObject.daughters.forEach[deletePerson(it)]
	call affectedEObject.sons.forEach[deletePerson(it)]
}

routine deletePerson(families::Member member) {
	match {
		retrieve persons::Person corresponding to member
		retrieve families::Family corresponding to member
	}
	update {
		removeCorrespondenceBetween(member, retrievedPerson)
		removeCorrespondenceBetween(member, retrievedFamily)
		removeCorrespondenceBetween(retrievedPerson, retrievedFamily)
		removeObject(retrievedPerson)
	}
}
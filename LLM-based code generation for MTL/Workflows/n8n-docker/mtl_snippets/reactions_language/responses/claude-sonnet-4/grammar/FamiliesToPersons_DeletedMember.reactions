import "http://vitruv.tools/methodologisttemplate/families" as families
import "http://vitruv.tools/methodologisttemplate/persons" as persons

reactions: familiesToPersons
in reaction to changes in families
execute actions in persons

reaction DeletedMember {
	after element families::Member deleted
	call deletePerson(affectedEObject)
}

routine deletePerson(families::Member deletedMember) {
	match {
		val correspondingPerson = retrieve persons::Person corresponding to deletedMember
		val correspondingFamily = retrieve persons::PersonRegister corresponding to deletedMember.familySon ?: deletedMember.familyDaughter ?: deletedMember.familyFather ?: deletedMember.familyMother
	}
	update {
		correspondingFamily.persons.remove(correspondingPerson)
		removeCorrespondencesBetween(deletedMember, correspondingPerson)
		removeCorrespondencesBetween(deletedMember, correspondingFamily)
		removeObject(correspondingPerson)
	}
}
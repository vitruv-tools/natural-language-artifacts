import "http://vitruv.tools/methodologisttemplate/families" as families
import "http://vitruv.tools/methodologisttemplate/persons" as persons

transformation familiesToPersons {
	between families and persons
	
	reaction InsertedFamilyRegister {
		after element families::FamilyRegister inserted as root
		call createPersonRegister(newValue)
	}
	
	routine createPersonRegister(families::FamilyRegister familyRegister) {
		match {
			require absence of persons::PersonRegister corresponding to familyRegister
		}
		create {
			val personRegister = new persons::PersonRegister
		}
		update {
			personRegister.id = familyRegister.id
			persistProjectRelative(personRegister, "persons", familyRegister.id + ".persons")
			addCorrespondenceBetween(familyRegister, personRegister)
		}
	}
}
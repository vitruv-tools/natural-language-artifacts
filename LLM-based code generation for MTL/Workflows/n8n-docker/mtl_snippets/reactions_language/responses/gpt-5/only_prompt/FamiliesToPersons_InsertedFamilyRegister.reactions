import epackage families from "http://vitruv.tools/reactionsparser/families"
import epackage persons from "http://vitruv.tools/reactionsparser/persons"

transformation familiesToPersons {
  persistence {
    model families "http://vitruv.tools/methodologisttemplate/families"
    model persons "http://vitruv.tools/methodologisttemplate/persons"
  }

  reaction InsertedFamilyRegister {
    after families.FamilyRegister inserted as root fr {
      call createPersonRegister(fr)
    }
  }

  routine createPersonRegister(fr: families.FamilyRegister) {
    guard {
      not existsCorrespondence fr with persons.PersonRegister
    }
    create {
      pr: persons.PersonRegister {
        id = fr.id
      }
    }
    persist pr in persons
    correspond fr <-> pr
  }
}
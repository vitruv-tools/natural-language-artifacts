import "http://vitruv.tools/methodologisttemplate/network" as network
import "http://vitruv.tools/methodologisttemplate/graph" as graph
transformation networkToGraph {
  reaction ComponentInsertedIntoSystem {
    after insert c: network.Component into s: network.System.components
    call createAndInsertEntity(c, s)
  }
  routine createAndInsertEntity(c: network.Component, s: network.System) {
    guard {
      !exists c <-> graph.Entity
    }
    retrieve {
      r: graph.Root by correspondence from s
    }
    create {
      e: graph.Entity
    }
    update {
      e.name = c.name
    }
    insert {
      e into r.entities
    }
    establish {
      c <-> e
    }
  }
}
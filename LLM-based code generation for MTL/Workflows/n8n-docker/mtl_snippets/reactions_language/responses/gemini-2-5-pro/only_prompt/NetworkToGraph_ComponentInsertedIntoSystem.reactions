transformation networkToGraph for
  network "http://vitruv.tools/methodologisttemplate/network",
  graph "http://vitruv.tools/methodologisttemplate/graph"

import network.*
import graph.*

reaction ComponentInsertedIntoSystem on insert newComponent : Component into system : System#components {
  call createAndInsertEntity(newComponent, system);
}

routine createAndInsertEntity(component : Component, system : System) {
  precondition {
    !exists(Entity | correspondence(component));
  }
  update {
    graphRoot : Root = get(Root | correspondence(system));
  }
  create {
    newEntity : Entity;
  }
  update {
    newEntity.name = component.name;
    graphRoot.entities.add(newEntity);
    correspondence(component, newEntity);
  }
}
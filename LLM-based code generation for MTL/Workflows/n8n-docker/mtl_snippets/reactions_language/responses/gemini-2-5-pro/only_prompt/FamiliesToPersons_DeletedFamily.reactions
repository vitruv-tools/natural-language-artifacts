transformation familiesToPersons

metamodels {
    families: "http://vitruv.tools/methodologisttemplate/families",
    persons: "http://vitruv.tools/methodologisttemplate/persons"
}

import families.Family
import families.Member
import persons.Person
import org.eclipse.emf.ecore.EObject

reaction DeletedFamily on preDelete Family {
    action {
        deletePerson(change.old.father)
        deletePerson(change.old.mother)
        change.old.daughters.forEach[d | deletePerson(d)]
        change.old.sons.forEach[s | deletePerson(s)]
    }
}

routine deletePerson(Member member) {
    if (member == null) {
        return
    }
    val person = getCorrespondence(Person, member)
    if (person != null) {
        val family = member.eContainer as Family
        deleteEObject(person)
        removeCorrespondences(person, member, family)
    }
}
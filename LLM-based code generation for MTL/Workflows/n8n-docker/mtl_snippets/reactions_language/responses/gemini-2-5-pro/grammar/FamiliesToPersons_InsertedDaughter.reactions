import "http://vitruv.tools/methodologisttemplate/families" as families
import "http://vitruv.tools/methodologisttemplate/persons" as persons
reactions: familiesToPersons 
in reaction to changes in families 
execute actions in persons {
	reaction InsertedDaughter {
		after element families::Member inserted in families::Family[daughters]
		call createOrFindFemale(change.affectedEObject, change.newAffectedEObject)
	}
	routine createOrFindFemale(families::Family family, families::Member daughter) {
		match {
			val female = retrieve persons::Female corresponding to daughter
		}
		create {
			val female = call createFemale(family, daughter)
		}
		update {
			call updateNameAndCorrespondencesOfCorrespondingPerson(family, daughter, female)
		}
	}
	routine createFemale(families::Family family, families::Member daughter) {
		match {
			val register = retrieve persons::PersonRegister
		}
		create {
			val newFemale = new persons::Female correspondence to daughter
		}
		update {
			register.persons.add(newFemale)
		}
	}
	routine updateNameAndCorrespondencesOfCorrespondingPerson(families::Family family, families::Member daughter, persons::Female female) {
		update {
			female.fullName = daughter.firstName + " " + family.lastName
		}
	}
}